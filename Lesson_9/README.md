# Домашнее задание №9
## Условие

        Запретить всем пользователям, кроме группы admin логин в выходные (суббота и воскресенье), без учета праздников.
        * Дать конкретному пользователю права работать с докером и возможность рестартить докер сервис.

Выполнил задание двумя способами.

## Способ №1

Создал двух пользователей *user* и *admin*, пользователя *admin* и *vagrant* (для корректной работы с ВМ) добавил в созданную группу *admins*.
Данным пользователям установлен пароль **Otus202001**.
Для реализации задачи использовал модули *pam_time.so* и *pam_succeed_if.so*. С помощью модуля *pam_time.so* запретил вход всем в выходные, а
с помощью *pam_succeed_if.so* добавил в исключение группу *admins*. 

В файл */etc/security/time.conf* была добавлена запись следующего вида

        *;*;*;!Wk0000-2400

Для того, чтобы ограничить вход из консоли и по ssh, изменения вносил в файлы */etc/pam.d/sshd* и */etc/pam.d/login*

        account    [success=1 default=ignore] pam_succeed_if.so user ingroup admins
        account required pam_time.so

Для проверки необходимо скачать из данного репозитория GitHub каталог Lesson_9 и перейти в него. В Vagrantfile должна быть раскомментирована строка

        box.vm.provision "shell", path: "./scripts/method1.sh"

Далее необходимо выполнить в терминале

        vagrant up
        vagrant ssh

Для проверки сменим дату, это можно сделать следующей командой

        sudo date +%Y%m%d -s "20200315"

Теперь из другого окна терминала можно попробовать войти с помощью ssh под учетными записями *user* и *admin*, для этого необходимо выполнить

        ssh user@192.168.11.101

В ответ система выдаст

        user@192.168.11.101's password: 
        Connection closed by 192.168.11.101 port 22

Для проверки входа через консоль, необходимо открыть консоль ВМ непосредственно из Virtualbox. ВМ называется *pam*

## Способ №2

Данный способ реализован с помощью модуля *pam_exec.so*. Проверка выполняется на основе скрипта *test_login.sh*. Пользователи и группа из предыдущего примера.

        #!/bin/bash
        GR=$(id -Gn $PAM_USER | grep -c admins)
        if [ "$GR" -eq 1 ]; then
            exit 0
        elif [ "$GR" -eq 0 -a $(date +%u) -le 5 ]; then
            exit 0
        else
            exit 1
        fi

Данный скрипт выполняет проверку, состоит ли пользователь в группе *admins*, если да, то вход разрешается. Если это обычный пользователь, то
выполняется проверка, является ли день будним, если оба условия соблюдены, то пользователю разрешается вход в систему, иначе нет.
Проверка также будет осуществляться как при логине с помощью ssh, так и через консоль.
Для проверки необходимо скачать из данного репозитория GitHub каталог Lesson_9 и перейти в него. В Vagrantfile должна быть раскомментирована строка

        box.vm.provision "shell", path: "./scripts/method2.sh"

Далее необходимо выполнить в терминале

        vagrant up
        vagrant ssh

Для проверки сменим дату, это можно сделать следующей командой

        sudo date +%Y%m%d -s "20200315"

Теперь из другого окна терминала можно попробовать войти с помощью ssh под учетными записями *user* и *admin*, для этого необходимо выполнить

        ssh user@192.168.11.101

Для проверки входа через консоль, необходимо открыть консоль ВМ непосредственно из Virtualbox. ВМ называется *pam*

## Задание с *

Чтобы дать конкретному пользователю права работать с докером его необходимо включить в состав группы **docker**, если группа не существует, то её нужно создать

        groupadd docker
        usermod -aG docker <имя_пользователя>
        newgrp docker

Предоставить возможность делать перезапуск службы docker, можно следующей командой

        echo '%<имя_пользователя> ALL=NOPASSWD: /bin/systemctl restart docker' | sudo EDITOR='tee -a' visudo



        


