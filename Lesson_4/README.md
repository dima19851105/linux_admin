# Домашнее задание №4
## Условие

	написать скрипт для крона
	который раз в час присылает на заданную почту
	- X IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов 
	c момента последнего запуска скрипта
	- Y запрашиваемых адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов 
	c момента последнего запуска скрипта
	- все ошибки c момента последнего запуска
	- список всех кодов возврата с указанием их кол-ва с момента последнего запуска
	в письме должно быть прописан обрабатываемый временной диапазон
	должна быть реализована защита от мультизапуска
	
Лог файл nginx был взят из личного кабинета.
Для отправки email с результатами работы скрипта использовал утилиту mail из пакета mailx.

### nginx_parser.sh

Это основной скрипт, который выполняет обработку лога nginx.
В скрипте прописано, что коды возврата это все, что начинаются на 2 и 3, то есть все 200 и 300.
Коды ошибок все 400 и 500.
Для решения задачи использовал функции, sed, awk, grep.

### mono_launch.sh

Предотвращает мультизапуск основного скрипта

### send_mail_logs.sh

Данный скрипт помещается в каталог /etc/cron.hourly/ и будет выполняться 1 раз в час. Отправляются результаты работы на адрес *root@localhost*, так как если указывать свой адрес, то такие письма попадают сразу в спам. Прочитать письмо с результатами работы скрипта можно открыв файл /var/mail/root.

### provision.sh

При развертывании ВМ из vagrantfile устанавливает утилиту mail. Так как лог файл за 2019 год, во время развертывания заменяется дата на текущую, это так ради пущей правдоподобности =)

## Запуск стенда.

Для развертывания ВМ необходимо скачать каталог Lesson_4 из данного репозитория и перейти в него. Из данного каталога выполнить команду в терминале:

	vagrant up
	
В результате раз в час на почту *root@localhost* будет приходить результат выполнения скрипта. Для проверки необходимо войти в ВМ, для этого необходимо ввести в терминале:

	vagrant ssh
	
Просмотреть файл *root* в каталоге */var/mail/* любым доступным методом.

Чтобы не дожидаться выполнения скрипта можно воспользоваться следующей командой:

	vagrant ssh -c "sudo run-parts /etc/cron.hourly"
	
### Результат выполнения скрипта.

![result](https://github.com/parshyn-dima/screens/blob/master/lesson04/parsing_nginx_log.png)
